<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Accordion?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.ComboBox?>
<?import javafx.scene.control.DatePicker?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ScrollPane?>
<?import javafx.scene.control.Tab?>
<?import javafx.scene.control.TabPane?>
<?import javafx.scene.control.TableColumn?>
<?import javafx.scene.control.TableView?>
<?import javafx.scene.control.TextArea?>
<?import javafx.scene.control.TitledPane?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Priority?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.layout.VBox?>

<BorderPane xmlns="http://javafx.com/javafx/21"
            xmlns:fx="http://javafx.com/fxml"
            fx:controller="com.taller.proyecto_bd.ui.reportes.ReportesController"
            prefWidth="950" prefHeight="600"
            stylesheets="@../css/styles.css"
            styleClass="contenedor-entidades">

    <top>
        <HBox alignment="CENTER_LEFT" spacing="12" styleClass="encabezado-seccion">
            <padding>
                <Insets top="10" right="10" bottom="10" left="10"/>
            </padding>
            <Label text="Reportes y Consultas" styleClass="titulo-seccion"/>
        </HBox>
    </top>

    <center>
        <TabPane tabClosingPolicy="UNAVAILABLE">
            <tabs>
                <Tab text="Reportes">
                    <content>
                        <ScrollPane fitToWidth="true" hbarPolicy="NEVER">
                            <content>
                                <VBox spacing="18" style="-fx-padding: 15;">
                                    <TitledPane text="Factura detallada por venta" expanded="true">
                                        <content>
                                            <VBox spacing="10" styleClass="panel-formulario">
                                                <HBox spacing="10">
                                                    <ComboBox fx:id="cbReporteFacturaVenta" promptText="Seleccione venta"/>
                                                    <Region HBox.hgrow="ALWAYS"/>
                                                    <Button text="Generar" onAction="#generarReporteFactura" styleClass="btn-secundario"/>
                                                </HBox>
                                                <TextArea fx:id="txtReporteFactura" editable="false" wrapText="true" prefHeight="200"/>
                                            </VBox>
                                        </content>
                                    </TitledPane>

                                    <TitledPane text="Total de ventas por mes">
                                        <content>
                                            <VBox spacing="10" styleClass="panel-formulario">
                                                <HBox spacing="10">
                                                    <ComboBox fx:id="cbAnioVentasMes" promptText="Año"/>
                                                    <ComboBox fx:id="cbMesVentasMes" promptText="Mes"/>
                                                    <Button text="Calcular" onAction="#calcularVentasMensuales" styleClass="btn-secundario"/>
                                                </HBox>
                                                <Label fx:id="lblVentasMesResultado" styleClass="mensaje-estado"/>
                                            </VBox>
                                        </content>
                                    </TitledPane>

                                    <TitledPane text="IVA total por trimestre">
                                        <content>
                                            <VBox spacing="10" styleClass="panel-formulario">
                                                <HBox spacing="10">
                                                    <ComboBox fx:id="cbAnioIVA" promptText="Año"/>
                                                    <ComboBox fx:id="cbTrimestre" promptText="Trimestre"/>
                                                    <Button text="Calcular" onAction="#calcularIvaTrimestral" styleClass="btn-secundario"/>
                                                </HBox>
                                                <Label fx:id="lblIvaTrimestreResultado" styleClass="mensaje-estado"/>
                                            </VBox>
                                        </content>
                                    </TitledPane>

                                    <TitledPane text="Ventas por tipo en periodo">
                                        <content>
                                            <VBox spacing="10" styleClass="panel-formulario">
                                                <HBox spacing="10">
                                                    <DatePicker fx:id="dpDesdeTipo" promptText="Desde"/>
                                                    <DatePicker fx:id="dpHastaTipo" promptText="Hasta"/>
                                                    <Button text="Analizar" onAction="#calcularVentasPorTipo" styleClass="btn-secundario"/>
                                                </HBox>
                                                <Label fx:id="lblVentasContado" text="Ventas de contado: 0" />
                                                <Label fx:id="lblVentasCredito" text="Ventas a crédito: 0" />
                                            </VBox>
                                        </content>
                                    </TitledPane>

                                    <TitledPane text="Inventario por categoría con costos">
                                        <content>
                                            <VBox spacing="10" styleClass="panel-formulario">
                                                <TableView fx:id="tablaInventarioCategoria" prefHeight="220">
                                                    <columns>
                                                        <TableColumn fx:id="colInvCategoria" text="Categoría" prefWidth="180"/>
                                                        <TableColumn fx:id="colInvProductos" text="Productos" prefWidth="100"/>
                                                        <TableColumn fx:id="colInvStock" text="Stock total" prefWidth="110"/>
                                                        <TableColumn fx:id="colInvCostoCompra" text="Costo inventario" prefWidth="150"/>
                                                        <TableColumn fx:id="colInvValorVenta" text="Valor potencial" prefWidth="150"/>
                                                    </columns>
                                                </TableView>
                                            </VBox>
                                        </content>
                                    </TitledPane>

                                    <TitledPane text="Clientes con créditos morosos">
                                        <content>
                                            <VBox spacing="10" styleClass="panel-formulario">
                                                <TableView fx:id="tablaClientesMorosos" prefHeight="220">
                                                    <columns>
                                                        <TableColumn fx:id="colMorosoCliente" text="Cliente" prefWidth="200"/>
                                                        <TableColumn fx:id="colMorosoCedula" text="Documento" prefWidth="120"/>
                                                        <TableColumn fx:id="colMorosoSaldo" text="Saldo pendiente" prefWidth="140"/>
                                                        <TableColumn fx:id="colMorosoCuotas" text="Cuotas vencidas" prefWidth="130"/>
                                                    </columns>
                                                </TableView>
                                            </VBox>
                                        </content>
                                    </TitledPane>
                                </VBox>
                            </content>
                        </ScrollPane>
                    </content>
                </Tab>

                <Tab text="Consultas">
                    <content>
                        <ScrollPane fitToWidth="true" hbarPolicy="NEVER">
                            <content>
                                <VBox spacing="18" style="-fx-padding: 15;">
                                    <TitledPane text="Consulta 1: Ventas por cliente" expanded="true">
                                        <content>
                                            <VBox spacing="10" styleClass="panel-formulario">
                                                <TableView fx:id="tablaVentasCliente">
                                                    <columns>
                                                        <TableColumn fx:id="colVCCliente" text="Cliente" prefWidth="200"/>
                                                        <TableColumn fx:id="colVCVentas" text="Ventas" prefWidth="100"/>
                                                        <TableColumn fx:id="colVCTotal" text="Total vendido" prefWidth="140"/>
                                                    </columns>
                                                </TableView>
                                            </VBox>
                                        </content>
                                    </TitledPane>

                                    <TitledPane text="Consulta 2: Productos más vendidos">
                                        <content>
                                            <VBox spacing="10" styleClass="panel-formulario">
                                                <TableView fx:id="tablaProductosVendidos">
                                                    <columns>
                                                        <TableColumn fx:id="colPVProducto" text="Producto" prefWidth="200"/>
                                                        <TableColumn fx:id="colPVCantidad" text="Cantidad vendida" prefWidth="140"/>
                                                        <TableColumn fx:id="colPVTotal" text="Ingresos generados" prefWidth="150"/>
                                                    </columns>
                                                </TableView>
                                            </VBox>
                                        </content>
                                    </TitledPane>

                                    <TitledPane text="Consulta 3: Ventas por vendedor">
                                        <content>
                                            <VBox spacing="10" styleClass="panel-formulario">
                                                <TableView fx:id="tablaVentasVendedor">
                                                    <columns>
                                                        <TableColumn fx:id="colVVendedor" text="Vendedor" prefWidth="200"/>
                                                        <TableColumn fx:id="colVVentas" text="Ventas registradas" prefWidth="150"/>
                                                        <TableColumn fx:id="colVVTotal" text="Total vendido" prefWidth="150"/>
                                                    </columns>
                                                </TableView>
                                            </VBox>
                                        </content>
                                    </TitledPane>

                                    <TitledPane text="Consulta 4: Créditos activos por cliente">
                                        <content>
                                            <VBox spacing="10" styleClass="panel-formulario">
                                                <TableView fx:id="tablaCreditosCliente">
                                                    <columns>
                                                        <TableColumn fx:id="colCCCliente" text="Cliente" prefWidth="200"/>
                                                        <TableColumn fx:id="colCCActivos" text="Créditos activos" prefWidth="130"/>
                                                        <TableColumn fx:id="colCCSaldo" text="Saldo pendiente" prefWidth="150"/>
                                                    </columns>
                                                </TableView>
                                            </VBox>
                                        </content>
                                    </TitledPane>

                                    <TitledPane text="Consulta 5: Valor potencial del inventario">
                                        <content>
                                            <VBox spacing="10" styleClass="panel-formulario">
                                                <TableView fx:id="tablaValorInventario">
                                                    <columns>
                                                        <TableColumn fx:id="colVICategoria" text="Categoría" prefWidth="200"/>
                                                        <TableColumn fx:id="colVICompra" text="Valor a costo" prefWidth="150"/>
                                                        <TableColumn fx:id="colVIVenta" text="Valor a venta" prefWidth="150"/>
                                                    </columns>
                                                </TableView>
                                            </VBox>
                                        </content>
                                    </TitledPane>
                                </VBox>
                            </content>
                        </ScrollPane>
                    </content>
                </Tab>
            </tabs>
        </TabPane>
    </center>

</BorderPane>
